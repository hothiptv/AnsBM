<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AnsBM Admin</title>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: sans-serif; display: flex; margin: 0; height: 100vh; }
        #side { width: 280px; border-right: 1px solid #30363d; padding: 20px; background: #161b22; }
        #main { flex: 1; padding: 30px; display: flex; flex-direction: column; gap: 10px; }
        .file-item { padding: 12px; background: #21262d; border: 1px solid #30363d; margin-bottom: 8px; cursor: pointer; border-radius: 6px; display: flex; justify-content: space-between; }
        .file-item:hover { border-color: #58a6ff; }
        textarea { flex: 1; background: #0d1117; color: #7ee787; border: 1px solid #30363d; padding: 15px; border-radius: 8px; font-family: monospace; }
        input { background: #0d1117; color: white; border: 1px solid #30363d; padding: 10px; border-radius: 6px; }
        .btn-group { display: flex; gap: 10px; }
        button { padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; border: none; }
        #save { background: #238636; color: white; }
        #del { background: #da3633; color: white; display: none; }
        #copy { background: #1f6feb; color: white; display: none; }
    </style>
</head>
<body>
    <div id="side">
        <h3>ANSBM FILES <button onclick="newF()" style="float:right">+</button></h3>
        <div id="list"></div>
    </div>
    <div id="main">
        <input type="text" id="name" placeholder="T√™n t·ªáp...">
        <textarea id="code" placeholder="D√°n script..."></textarea>
        <div class="btn-group">
            <button id="save" onclick="handleFile(false)">L∆ØU D·ªÆ LI·ªÜU</button>
            <button id="del" onclick="handleFile(true)">X√ìA T·ªÜP</button>
            <button id="copy" onclick="copyL()">COPY RAW LINK</button>
        </div>
        <p id="msg"></p>
    </div>

    <script>
        const pass = window.location.pathname.replace('/','');
        async function load() {
            const res = await fetch('/api/files');
            const data = await res.json();
            const list = document.getElementById('list');
            list.innerHTML = "";
            for (let n in data) {
                let div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `<span>üìÑ ${n}</span>`;
                div.onclick = () => {
                    document.getElementById('name').value = n;
                    document.getElementById('code').value = data[n];
                    document.getElementById('del').style.display = "block";
                    document.getElementById('copy').style.display = "block";
                };
                list.appendChild(div);
            }
        }
        async function handleFile(isDelete) {
            const name = document.getElementById('name').value;
            const content = document.getElementById('code').value;
            if(!name) return;
            if(isDelete && !confirm("X√≥a file n√†y?")) return;
            
            document.getElementById('msg').innerText = "ƒêang x·ª≠ l√Ω...";
            await fetch('/api/save', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, content, isDelete })
            });
            document.getElementById('msg').innerText = isDelete ? "ƒê√£ x√≥a!" : "ƒê√£ l∆∞u!";
            if(isDelete) newF();
            load();
        }
        function newF() {
            document.getElementById('name').value = "";
            document.getElementById('code').value = "";
            document.getElementById('del').style.display = "none";
            document.getElementById('copy').style.display = "none";
        }
        function copyL() {
            const n = document.getElementById('name').value;
            const link = `${window.location.origin}/raw/${n}/${pass}`;
            navigator.clipboard.writeText(link);
            alert("ƒê√£ copy link b·∫£o m·∫≠t!");
        }
        load();
    </script>
</body>
</html>
